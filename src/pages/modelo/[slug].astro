---
// @ts-ignore
import { Masonry } from 'astro-masonry';
import Layout from '../../layouts/Layout.astro';
import { getPosts, getPostsByModel } from '../../services';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const posts = await getPosts();
  const slugs = [...new Set(posts.map(post => post.model?.slug?.current).filter(Boolean))];
  
  return slugs.map(slug => ({
    params: { slug },
    props: { slug }
  }));
}

const { slug } = Astro.props;
const modelPosts = await getPostsByModel(slug)
const fullname = modelPosts[0]?.model?.fullname || 'Modelo';
---

<Layout title={fullname}>
  <main>
    <section class="px-2 md:px-10">
      <!-- <h1 class="text-4xl md:text-6xl font-semibold text-center">{fullname}</h1> -->
      <!-- categoria y ubicacion -->
      <div class="border-t border-white/10 space-y-4 py-4 md:py-10">
        <div class="flex items-center gap-4 border-b border-white/10 text-xs md:text-sm py-4">
          <p>{fullname}</p>
          <p class="text-white/50">•</p>
          <p>{modelPosts[0]?.category?.title}</p>
          <p class="text-white/50">•</p>
          <p>{modelPosts[0]?.location?.title}</p>
        </div>

  
        <Masonry
  				class="flex gap-4 md:gap-10"
  				columnClass="flex flex-col gap-4 md:gap-10"
  				breakpointCols={{
  					default: modelPosts.length === 1 ? 1 : 2,
  					1100: 1
  				}}
  				sortByHeight={true}
  			>
          {modelPosts.map((post) => (
            <figure class="w-full bg-slate-950 text-white relative overflow-hidden">
              <Image
                class="w-full" 
                alt={`Foto de ${post.model?.fullname}`}
                width={post.image.asset.metadata.dimensions.width}
                height={post.image.asset.metadata.dimensions.height}
                src={post.image.asset.url} />
            </figure>
          ))}
  			</Masonry>

        <div class="flex items-center justify-center gap-4">
          {modelPosts[0]?.model?.rrss?.map(rs => {
            if (rs.includes('instagram')) {
              return (
                <a href={rs} target="_blank" class="social-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-instagram"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg> <span>{modelPosts[0]?.model?.fullname.split(' ')[0]}</span></a>
              )
            } else if (rs.includes('facebook')) {
              return (
                <a href={rs} target="_blank" class="social-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-facebook"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg> <span>{modelPosts[0]?.model?.fullname.split(' ')[0]}</span></a>
              )
            } else if (rs.includes('youtube')) {
              return (
                <a href={rs} target="_blank" class="social-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-youtube"><path d="M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17"/><path d="m10 15 5-3-5-3z"/></svg> <span>{modelPosts[0]?.model?.fullname.split(' ')[0]}</span></a>
              )
            } else return null
          })}
        </div>
      </div>
    </section>
  </main>
</Layout> 

<style>
  .social-button {
    @apply 
    text-white/50 
    hover:text-white 
    transition-colors 
    rounded-full 
    p-4 
    bg-white/10 
    hover:bg-white/20 
    flex 
    items-center 
    justify-center
    gap-2
    w-[200px]
    ;
  }
</style>